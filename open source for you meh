--if you edit, leave the credits pls S2

local NotificationLib = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

-- Tentar usar CoreGui primeiro (mais seguro)
local success, parent = pcall(function()
    return CoreGui
end)

if not success then
    parent = Players.LocalPlayer:WaitForChild("PlayerGui")
end

-- Limpar GUI antiga
task.spawn(function()
    pcall(function()
        for _, gui in pairs(parent:GetChildren()) do
            if gui.Name == "RobloxNotificationGui" and gui:IsA("ScreenGui") then
                gui:Destroy()
            end
        end
    end)
end)

task.wait(0.3)

-- Nome genérico para não chamar atenção
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RobloxNotificationGui" -- Nome que parece oficial
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999 -- Fica por cima de tudo
screenGui.Parent = parent

local container = Instance.new("Frame")
container.Name = "Container"
container.Size = UDim2.new(0, 300, 1, 0)
container.Position = UDim2.new(1, -310, 0, 10)
container.BackgroundTransparency = 1
container.Parent = screenGui

local activeNotifications = {}

local function criarNotificacao(titulo, mensagem, duracao, cor)
    -- Limitar a 3 notificações ativas
    while #activeNotifications >= 3 do
        pcall(function()
            if activeNotifications[1] then
                activeNotifications[1]:Destroy()
            end
            table.remove(activeNotifications, 1)
        end)
        task.wait(0.1)
    end
    
    duracao = tonumber(duracao) or 5
    titulo = tostring(titulo or "Notification")
    mensagem = tostring(mensagem or "")
    cor = cor or Color3.fromRGB(52, 152, 219)
    
    local notif = Instance.new("Frame")
    notif.Name = "Notif"
    notif.Size = UDim2.new(1, 0, 0, 0)
    notif.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    notif.BorderSizePixel = 0
    notif.ClipsDescendants = true

    local barra = Instance.new("Frame")
    barra.Name = "Bar"
    barra.Size = UDim2.new(0, 4, 1, 0)
    barra.BackgroundColor3 = cor
    barra.BorderSizePixel = 0
    barra.Parent = notif
    
    local tituloLabel = Instance.new("TextLabel")
    tituloLabel.Name = "Title"
    tituloLabel.Size = UDim2.new(1, -50, 0, 25)
    tituloLabel.Position = UDim2.new(0, 15, 0, 8)
    tituloLabel.BackgroundTransparency = 1
    tituloLabel.Text = titulo
    tituloLabel.Font = Enum.Font.GothamBold
    tituloLabel.TextSize = 16
    tituloLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    tituloLabel.TextXAlignment = Enum.TextXAlignment.Left
    tituloLabel.Parent = notif
    
    local mensagemLabel = Instance.new("TextLabel")
    mensagemLabel.Name = "Message"
    mensagemLabel.Size = UDim2.new(1, -50, 0, 40)
    mensagemLabel.Position = UDim2.new(0, 15, 0, 35)
    mensagemLabel.BackgroundTransparency = 1
    mensagemLabel.Text = mensagem
    mensagemLabel.Font = Enum.Font.Gotham
    mensagemLabel.TextSize = 14
    mensagemLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    mensagemLabel.TextXAlignment = Enum.TextXAlignment.Left
    mensagemLabel.TextYAlignment = Enum.TextYAlignment.Top
    mensagemLabel.TextWrapped = true
    mensagemLabel.Parent = notif
    
    local btnFechar = Instance.new("TextButton")
    btnFechar.Name = "Close"
    btnFechar.Size = UDim2.new(0, 30, 0, 30)
    btnFechar.Position = UDim2.new(1, -35, 0, 5)
    btnFechar.BackgroundTransparency = 1
    btnFechar.Text = "×"
    btnFechar.Font = Enum.Font.GothamBold
    btnFechar.TextSize = 20
    btnFechar.TextColor3 = Color3.fromRGB(150, 150, 150)
    btnFechar.Parent = notif
    
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 8)
    uiCorner.Parent = notif
    
    local uiStroke = Instance.new("UIStroke")
    uiStroke.Color = Color3.fromRGB(50, 50, 50)
    uiStroke.Thickness = 1
    uiStroke.Parent = notif
    
    -- Posição calculada
    local yPos = 0
    for _, n in ipairs(activeNotifications) do
        if n and n.Parent then
            yPos = yPos + 90
        end
    end
    
    notif.Position = UDim2.new(0, 0, 0, yPos)
    notif.Parent = container
    table.insert(activeNotifications, notif)
    
    -- Animação suave
    task.spawn(function()
        pcall(function()
            local tween = TweenService:Create(notif, TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(1, 0, 0, 80)
            })
            tween:Play()
        end)
    end)
    
    local isRemoving = false
    
    local function removerNotificacao()
        if isRemoving then return end
        isRemoving = true
        
        task.spawn(function()
            pcall(function()
                local tweenOut = TweenService:Create(notif, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                    Size = UDim2.new(1, 0, 0, 0)
                })
                tweenOut:Play()
                tweenOut.Completed:Wait()
                
                for i, n in ipairs(activeNotifications) do
                    if n == notif then
                        table.remove(activeNotifications, i)
                        break
                    end
                end
                
                -- Reposicionar
                local currentY = 0
                for _, n in ipairs(activeNotifications) do
                    if n and n.Parent then
                        pcall(function()
                            TweenService:Create(n, TweenInfo.new(0.25, Enum.EasingStyle.Quad), {
                                Position = UDim2.new(0, 0, 0, currentY)
                            }):Play()
                        end)
                        currentY = currentY + 90
                    end
                end
                
                notif:Destroy()
            end)
        end)
    end
    
    btnFechar.MouseButton1Click:Connect(removerNotificacao)
    
    -- Auto-remover
    task.delay(duracao, function()
        if not isRemoving then
            removerNotificacao()
        end
    end)
end

-- API pública com proteção
function NotificationLib:Notificar(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(52, 152, 219))
    end)
end

function NotificationLib:Sucesso(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(46, 204, 113))
    end)
end

function NotificationLib:Erro(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(231, 76, 60))
    end)
end

function NotificationLib:Aviso(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(241, 196, 15))
    end)
end

function NotificationLib:Info(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(52, 152, 219))
    end)
end

function NotificationLib:Custom(titulo, mensagem, duracao, cor)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, cor)
    end)
end

function NotificationLib:LimparTudo()
    task.spawn(function()
        pcall(function()
            for _, notif in ipairs(activeNotifications) do
                if notif then
                    notif:Destroy()
                end
            end
            activeNotifications = {}
        end)
    end)
end

return NotificationLib
