--if you edit, leave the credits pls S2

local NotificationLib = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function encontrarGuiHost()
    local guis = playerGui:GetChildren()
    for _, gui in ipairs(guis) do
        if gui:IsA("ScreenGui") and gui.Name ~= "NotificationGui" and gui.Name ~= "RobloxNotificationGui" then
            -- Preferir GUIs que já existem do jogo
            if not gui.Name:match("Notification") and not gui.Name:match("Custom") then
                return gui
            end
        end
    end
    return nil
end

local hostGui = encontrarGuiHost()
local container

if not hostGui then
    -- Aguardar um pouco antes de criar
    task.wait(2)
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "UI" -- Nome super genérico
    screenGui.ResetOnSpawn = false
    screenGui.DisplayOrder = 100
    screenGui.Parent = playerGui
    hostGui = screenGui
end

pcall(function()
    local old = hostGui:FindFirstChild("_NC")
    if old then
        old:Destroy()
    end
end)

task.wait(0.5)

container = Instance.new("Frame")
container.Name = "_NC" -- Nome críptico
container.Size = UDim2.new(0, 300, 1, 0)
container.Position = UDim2.new(1, -310, 0, 10)
container.BackgroundTransparency = 1
container.ZIndex = 999
container.Parent = hostGui

local activeNotifications = {}
local maxNotifications = 3

local function criarNotificacao(titulo, mensagem, duracao, cor)
    while #activeNotifications >= maxNotifications do
        pcall(function()
            if activeNotifications[1] and activeNotifications[1].Parent then
                activeNotifications[1]:Destroy()
            end
            table.remove(activeNotifications, 1)
        end)
        task.wait(0.05)
    end
    
    duracao = tonumber(duracao) or 5
    titulo = tostring(titulo or "")
    mensagem = tostring(mensagem or "")
    cor = cor or Color3.fromRGB(52, 152, 219)
    
    local notif = Instance.new("Frame")
    notif.Name = "_N"
    notif.Size = UDim2.new(1, 0, 0, 0)
    notif.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    notif.BorderSizePixel = 0
    notif.ClipsDescendants = true
    notif.ZIndex = 1000

    task.wait(0.02) -- Micro delay entre criações

    local barra = Instance.new("Frame")
    barra.Size = UDim2.new(0, 4, 1, 0)
    barra.BackgroundColor3 = cor
    barra.BorderSizePixel = 0
    barra.ZIndex = 1001
    barra.Parent = notif
    
    task.wait(0.02)
    
    local tituloLabel = Instance.new("TextLabel")
    tituloLabel.Size = UDim2.new(1, -50, 0, 25)
    tituloLabel.Position = UDim2.new(0, 15, 0, 8)
    tituloLabel.BackgroundTransparency = 1
    tituloLabel.Text = titulo
    tituloLabel.Font = Enum.Font.GothamBold
    tituloLabel.TextSize = 16
    tituloLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    tituloLabel.TextXAlignment = Enum.TextXAlignment.Left
    tituloLabel.ZIndex = 1002
    tituloLabel.Parent = notif
    
    task.wait(0.02)
    
    local mensagemLabel = Instance.new("TextLabel")
    mensagemLabel.Size = UDim2.new(1, -50, 0, 40)
    mensagemLabel.Position = UDim2.new(0, 15, 0, 35)
    mensagemLabel.BackgroundTransparency = 1
    mensagemLabel.Text = mensagem
    mensagemLabel.Font = Enum.Font.Gotham
    mensagemLabel.TextSize = 14
    mensagemLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    mensagemLabel.TextXAlignment = Enum.TextXAlignment.Left
    mensagemLabel.TextYAlignment = Enum.TextYAlignment.Top
    mensagemLabel.TextWrapped = true
    mensagemLabel.ZIndex = 1002
    mensagemLabel.Parent = notif
    
    task.wait(0.02)
    
    local btnFechar = Instance.new("TextButton")
    btnFechar.Size = UDim2.new(0, 30, 0, 30)
    btnFechar.Position = UDim2.new(1, -35, 0, 5)
    btnFechar.BackgroundTransparency = 1
    btnFechar.Text = "×"
    btnFechar.Font = Enum.Font.GothamBold
    btnFechar.TextSize = 20
    btnFechar.TextColor3 = Color3.fromRGB(150, 150, 150)
    btnFechar.ZIndex = 1003
    btnFechar.Parent = notif
    
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 8)
    uiCorner.Parent = notif
    
    local uiStroke = Instance.new("UIStroke")
    uiStroke.Color = Color3.fromRGB(50, 50, 50)
    uiStroke.Thickness = 1
    uiStroke.Parent = notif
    
    local yPos = 0
    for _, n in ipairs(activeNotifications) do
        if n and n.Parent then
            yPos = yPos + 90
        end
    end
    
    notif.Position = UDim2.new(0, 0, 0, yPos)
    
    task.wait(0.05)
    notif.Parent = container
    table.insert(activeNotifications, notif)
    
    task.spawn(function()
        pcall(function()
            TweenService:Create(notif, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(1, 0, 0, 80)
            }):Play()
        end)
    end)
    
    local isRemoving = false
    
    local function remover()
        if isRemoving or not notif or not notif.Parent then return end
        isRemoving = true
        
        task.spawn(function()
            pcall(function()
                local tw = TweenService:Create(notif, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                    Size = UDim2.new(1, 0, 0, 0)
                })
                tw:Play()
                tw.Completed:Wait()
                
                for i, n in ipairs(activeNotifications) do
                    if n == notif then
                        table.remove(activeNotifications, i)
                        break
                    end
                end
                
                local currentY = 0
                for _, n in ipairs(activeNotifications) do
                    if n and n.Parent then
                        pcall(function()
                            TweenService:Create(n, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {
                                Position = UDim2.new(0, 0, 0, currentY)
                            }):Play()
                        end)
                        currentY = currentY + 90
                    end
                end
                
                task.wait(0.05)
                if notif then notif:Destroy() end
            end)
        end)
    end
    
    btnFechar.MouseButton1Click:Connect(remover)
    
    task.delay(duracao, function()
        if not isRemoving then
            remover()
        end
    end)
end

function NotificationLib:Notificar(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(52, 152, 219))
    end)
end

function NotificationLib:Sucesso(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(46, 204, 113))
    end)
end

function NotificationLib:Erro(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(231, 76, 60))
    end)
end

function NotificationLib:Aviso(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(241, 196, 15))
    end)
end

function NotificationLib:Info(titulo, mensagem, duracao)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, Color3.fromRGB(52, 152, 219))
    end)
end

function NotificationLib:Custom(titulo, mensagem, duracao, cor)
    task.spawn(function()
        pcall(criarNotificacao, titulo, mensagem, duracao, cor)
    end)
end

function NotificationLib:LimparTudo()
    task.spawn(function()
        pcall(function()
            for _, notif in ipairs(activeNotifications) do
                if notif then notif:Destroy() end
            end
            activeNotifications = {}
        end)
    end)
end

return NotificationLib
